<?php

/**
 * ProfessionalTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class ProfessionalTable extends PluginProfessionalTable
{
  public function createQuery($alias = 'p')
  {
    $o = $alias != 'o' ? 'o' : 'o1';
    $c = $alias != 'c' ? 'c' : 'c1';
    $t = $alias != 't' ? 't' : 't1';
    
    $query = parent::createQuery($alias)
        ->leftJoin("$alias.Organism $o")
        ->leftJoin("$alias.ProfessionalType $t")
        ->leftJoin("$alias.Contact $c")
        ->orderBy("$c.name, $c.firstname, $o.name, $alias.name, $t.name");
    return $query;
  }

  public function doSelectOnlyGrp(Doctrine_Query $q)
  {
    $a = $q->getRootAlias();
    $o = $a != 'o' ? 'o' : 'o1';
    $c = $a != 'c' ? 'c' : 'c1';
    $t = $a != 't' ? 't' : 't1';
    $gce = $a != 'gce' ? 'gce' : 'gce1';
    
    $q->leftJoin("$a.ContactEntries $gce")
      ->andWhere('gce.id IS NOT NULL')
      ->select("$a.*, $t.*, $c.*, $gce.*");
    
    // limitating to user's MetaEvents
    if ( sfContext::hasInstance() )
    $q->leftJoin('gce.Entry ge')
      ->leftJoin('ge.ManifestationEntries gme')
      ->leftJoin('gme.Manifestation m')
      ->leftJoin('m.Event e')
      ->andWhereIn('e.meta_event_id',array_keys(sfContext::getInstance()->getUser()->getMetaEventsCredentials()));
    
    return $q;
  }

    /**
     * Returns an instance of this class.
     *
     * @return object ProfessionalTable
     */
    public static function getInstance()
    {
        return Doctrine_Core::getTable('Professional');
    }
}
